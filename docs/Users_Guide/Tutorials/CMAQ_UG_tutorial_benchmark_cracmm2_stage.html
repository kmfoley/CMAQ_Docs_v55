
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CMAQ Installation &amp; Benchmarking Tutorial for CRACMM2 &#8212; CMAQ_Documentation 0.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../_static/documentation_options.js?v=10f1778b"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Users_Guide/Tutorials/CMAQ_UG_tutorial_benchmark_cracmm2_stage';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">CMAQ_Documentation 0.2 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../README.html">
         User's Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="README.html">
         Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../Developers_Guide/CMAQ_Dev_Guide.html">
         Developer's Guide
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../README.html">
         User's Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="README.html">
         Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../Developers_Guide/CMAQ_Dev_Guide.html">
         Developer's Guide
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">CMAQ Installation &amp; Benchmarking Tutorial for CRACMM2</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="cmaq-installation-benchmarking-tutorial-for-cracmm2">
<h1>CMAQ Installation &amp; Benchmarking Tutorial for CRACMM2<a class="headerlink" href="#cmaq-installation-benchmarking-tutorial-for-cracmm2" title="Link to this heading">#</a></h1>
<p>Purpose: This guide describes how to install and run the CMAQ test case for the CRACMM2 mechanism with the STAGE dry deposition scheme, which serves two different purposes. The first being to familiarize the user with the CMAQ suite of programs and how they work together, and secondly to verify the installation of the software on your system via benchmarking.</p>
<p>Benchmarking refers to a simulation that is used to verify that the software is installed correctly.  Benchmarking CMAQ is recommended in the following circumstances:</p>
<ul class="simple">
<li><p>Installation by a new user</p></li>
<li><p>Installation on a new server</p></li>
<li><p>Following kernel upgrades</p></li>
<li><p>Following Fortran/C compiler upgrades</p></li>
<li><p>Following netCDF or I/O API library upgrades</p></li>
</ul>
<section id="system-checks">
<h2>System Checks<a class="headerlink" href="#system-checks" title="Link to this heading">#</a></h2>
<p>The following support software are required for compiling and running CMAQ.</p>
<ol class="arabic simple">
<li><p>Fortran and C compilers, e.g., <a class="reference external" href="https://software.intel.com/en-us/fortran-compilers">Intel</a>, <a class="reference external" href="http://www.pgroup.com">Portland Group</a>, <a class="reference external" href="https://gcc.gnu.org/wiki/GFortran">Gnu</a></p></li>
<li><p><a class="reference external" href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">Git</a></p></li>
<li><p>Message Passing Interface (MPI), e.g., <a class="reference external" href="https://www.open-mpi.org">OpenMPI</a> or <a class="reference external" href="http://www.mcs.anl.gov/research/projects/mpich2">MVAPICH2</a>.</p></li>
<li><p>Latest release of <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/docs/getting_and_building_netcdf.html">netCDF-C</a> and <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/docs/building_netcdf_fortran.html">netCDF-Fortran</a> <strong>built with netCDF4, HDF5, HDF4, DAP client, PnetCDF, or zlib support</strong></p></li>
<li><p><a class="reference external" href="https://www.cmascenter.org/download/software/ioapi/ioapi_3-2.cfm?DB=TRUE">I/O API</a> version 3.2 <strong>tagged 20200828</strong>
(note: if you have not installed the above libraries, please see the CMAQ_UG_tutorial_build_[gcc/intel/pgi].md tutorials available here:
https://github.com/USEPA/CMAQ/tree/main/DOCS/Users_Guide/Tutorials</p></li>
</ol>
<p>The suggested hardware requirements for running the CMAQ Southeast Benchmark case on a Linux workstation are:</p>
<ol class="arabic simple">
<li><p>Linux environment with a 16 processors</p></li>
<li><p>16 GB RAM</p></li>
<li><p>400 GB hard drive storage</p></li>
</ol>
</section>
<section id="install-cmaq-and-required-libraries">
<h2>Install CMAQ and Required Libraries<a class="headerlink" href="#install-cmaq-and-required-libraries" title="Link to this heading">#</a></h2>
<p>In the directory where you would like to install CMAQ, create the directory issue the following command to clone the EPA GitHub repository for CMAQv5.5:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">-</span><span class="n">b</span> <span class="n">main</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">USEPA</span><span class="o">/</span><span class="n">CMAQ</span><span class="o">.</span><span class="n">git</span> <span class="n">CMAQ_REPO</span>
</pre></div>
</div>
<p>For instructions on installing CMAQ from Zip files, see <a class="reference internal" href="../CMAQ_UG_ch05_running_a_simulation.html"><span class="std std-doc">Chapter 5</span></a>.</p>
</section>
<section id="check-out-a-new-branch-in-the-cmaq-repository">
<h2>Check Out a new Branch in the CMAQ Repository<a class="headerlink" href="#check-out-a-new-branch-in-the-cmaq-repository" title="Link to this heading">#</a></h2>
<p>Checking out a new branch is a good idea even if you are not doing code development, per se. It is likely that you will want to retrieve new updates in the future, and an easy way to do this is through the main branch in the git repo. Thus, it is beneficial to leave it unperturbed if possible.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">CMAQ_REPO</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="n">my_branch</span>
</pre></div>
</div>
</section>
<section id="configure-the-cmaq-build-environment">
<h2>Configure the CMAQ build environment<a class="headerlink" href="#configure-the-cmaq-build-environment" title="Link to this heading">#</a></h2>
<p>The user has two options for building an environment. She or he may build and run CMAQ components directly in the repository structure (object files and executables will be ignored with .gitignore), or they may extract the build and run scripts out of the repository and work in a separate location. If you would like to build directly in the repository, skip to “Link the CMAQ Libraries” below.</p>
<section id="build-and-run-in-a-user-specified-directory-outside-of-the-repository">
<h3>Build and run in a user-specified directory outside of the repository<a class="headerlink" href="#build-and-run-in-a-user-specified-directory-outside-of-the-repository" title="Link to this heading">#</a></h3>
<p>In the top level of CMAQ_REPO, the bldit_project.csh script will automatically replicate the CMAQ folder structure and copy every build and run script out of the repository so that you may modify them freely without version control.</p>
<p>In bldit_project.csh, modify the variable $CMAQ_HOME to identify the folder that you would like to install the CMAQ package under. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">CMAQ_HOME</span> <span class="o">=</span> <span class="p">[</span><span class="n">your_install_path</span><span class="p">]</span><span class="o">/</span><span class="n">CMAQ_v5</span><span class="mf">.5</span>
</pre></div>
</div>
<p>Now execute the script.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">bldit_project</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
</section>
</section>
<section id="link-the-cmaq-libraries">
<h2>Link the CMAQ Libraries<a class="headerlink" href="#link-the-cmaq-libraries" title="Link to this heading">#</a></h2>
<p>The CMAQ build scripts require the following libraries and INCLUDE files to be available in the CMAQ_LIB directory (Note: the CMAQ_LIB gets set automatically by the config_cmaq.csh script, where <code class="docutils literal notranslate"><span class="pre">CMAQ_LIB</span> <span class="pre">=</span> <span class="pre">$CMAQ_HOME/lib</span></code>):</p>
<ul class="simple">
<li><p>netCDF C library files are located in the <code class="docutils literal notranslate"><span class="pre">$CMAQ_LIB/netcdf/lib</span></code> directory</p></li>
<li><p>netCDF Fortran library files are located in the <code class="docutils literal notranslate"><span class="pre">$CMAQ_LIB/netcdff/lib</span></code> directory</p></li>
<li><p>I/O API library, include files and module files are located in the <code class="docutils literal notranslate"><span class="pre">$CMAQ_LIB/ioapi</span></code> directory</p></li>
<li><p>MPI library and INCLUDE files are located in the <code class="docutils literal notranslate"><span class="pre">$CMAQ_LIB/mpi</span></code> directory</p></li>
</ul>
<p>The config_cmaq.csh script will automatically link the required libraries into the CMAQ_LIB directory. Set the locations of the netCDF, I/O API, and MPI installations on your Linux system with the following config_cmaq.csh environment variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">setenv</span> <span class="pre">IOAPI_INCL_DIR</span></code>: the location of the I/O API include header files on your system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setenv</span> <span class="pre">IOAPI_LIB_DIR</span></code>: the location of compiled I/O API libraries on your system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setenv</span> <span class="pre">NETCDF_LIB_DIR</span></code>: the location of the netCDF C library installation on your system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setenv</span> <span class="pre">NETCDF_INCL_DIR</span></code>: the location of the netCDF C include files on your system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setenv</span> <span class="pre">NETCDFF_LIB_DIR</span></code>: the location of the netCDF Fortran library installation on your system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setenv</span> <span class="pre">NETCDFF_INCL_DIR</span></code>: the location of the netCDF Fortran include files on your system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setenv</span> <span class="pre">MPI_LIB_DIR</span></code>: the location of the MPI (OpenMPI or MVAPICH) on your system.</p></li>
</ul>
<p>For example, if your netCDF C libraries are installed in /usr/local/netcdf/lib, set <code class="docutils literal notranslate"><span class="pre">NETCDF_LIB_DIR</span></code> to /usr/local/netcdf/lib. Similarly, if your I/O API library is installed in /home/cmaq/ioapi/Linux2_x86_64gfort, set <code class="docutils literal notranslate"><span class="pre">IOAPI_LIB_DIR</span></code> to /home/cmaq/ioapi/Linux2_x86_64gfort.</p>
<p><em>1.</em> Check the names of the I/O API and netCDF libraries using the <code class="docutils literal notranslate"><span class="pre">ioapi_lib</span></code> and <code class="docutils literal notranslate"><span class="pre">netcdf_lib</span></code> script variables.</p>
<p><em>2.</em> Check the name of the MPI library using the <code class="docutils literal notranslate"><span class="pre">mpi_lib</span></code> script variable. For MVAPICH use <code class="docutils literal notranslate"><span class="pre">-lmpich</span></code>; for openMPI use <code class="docutils literal notranslate"><span class="pre">-lmpi</span></code>.</p>
<p>Links to these libraries will automatically be created when you run any of the build or run scripts. To manually create these libraries (this is optional), execute the config_cmaq.csh script, identifying the compiler in the command line [intel | gcc | pgi]:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">config_cmaq</span><span class="o">.</span><span class="n">csh</span> <span class="p">[</span><span class="n">compiler</span><span class="p">]</span> 
</pre></div>
</div>
<p>You may also identify the version of the compiler if you wish it to be identified in build directory and executable names. This is optional. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">config_cmaq</span><span class="o">.</span><span class="n">csh</span> <span class="n">gcc</span> <span class="mf">9.5</span>
</pre></div>
</div>
</section>
<section id="install-the-cmaq-reference-input-and-output-benchmark-data">
<h2>Install the CMAQ reference input and output benchmark data<a class="headerlink" href="#install-the-cmaq-reference-input-and-output-benchmark-data" title="Link to this heading">#</a></h2>
<p>Download the CMAQ two day reference input and output data for the CRACMM2 mechanism from the <a class="reference external" href="https://cmaq-release-benchmark-data-for-easy-download.s3.amazonaws.com/v5_5/CMAQv5.5_2018_12NE3_Benchmark_cracmm2_stage_2Day_Input.tar.gz">AWS CMAS Data Warehouse</a>. The CMAQ benchmark test case is a two day simulation for July 1-2 2018 on a 100 column x 105 row x 35 layer 12-km resolution domain over the northeast U.S.<br />
Copy the data to <code class="docutils literal notranslate"><span class="pre">$CMAQ_DATA</span></code>. Navigate to the <code class="docutils literal notranslate"><span class="pre">$CMAQ_DATA</span></code> directory, unzip and untar the two day benchmark input files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $CMAQ_DATA
wget https://cmaq-release-benchmark-data-for-easy-download.s3.amazonaws.com/v5_5/CMAQv5.5_2018_12NE3_Benchmark_cracmm2_stage_2Day_Input.tar.gz
tar xvzf CMAQv5.4_2018_12NE3_Benchmark_2Day_Input_CRACCM2.tar.gz
mkdir ref_output
cd ref_output
wget https://cmaq-release-benchmark-data-for-easy-download.s3.amazonaws.com/v5_5/output_CCTM_v55_gcc_Bench_2018_12NE3_cracmm2_stage.tar.gz
tar -xzvf output_CCTM_v55_gcc_Bench_2018_12NE3_cracmm2_stage.tar.gz

</pre></div>
</div>
</section>
<section id="compiling-cmaq">
<h2>Compiling CMAQ<a class="headerlink" href="#compiling-cmaq" title="Link to this heading">#</a></h2>
<p><em>Before proceeding, it should be noted that building the ICON and BCON executables are optional steps when working specifically with the benchmark data. This is because the initial condition and boundary condition files have been provided for you within the benchmark data set. For further information on these preprocessors please reference <a class="reference internal" href="../CMAQ_UG_ch04_model_inputs.html"><span class="std std-doc">Chapter 4</span></a>.</em></p>
<p>Create the model executables for CCTM using the steps shown below.</p>
<p>Create a bldit_cctm script for this benchmark and verify or modify the settings listed below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">bldit_cctm</span><span class="o">.</span><span class="n">csh</span> <span class="n">bldit_cctm_cracmm2_stage</span><span class="o">.</span><span class="n">csh</span>
<span class="n">vi</span> <span class="n">bldit_cctm_cracmm2_stage</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
<section id="configuration-for-multi-processor-runs-default">
<h3>Configuration for multi-processor runs (default):<a class="headerlink" href="#configuration-for-multi-processor-runs-default" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">ParOpt</span> <span class="c1">#&gt;  Option for MPI Runs</span>
</pre></div>
</div>
</section>
<section id="configuration-for-single-processor-runs-optional">
<h3>Configuration for single-processor runs (optional):<a class="headerlink" href="#configuration-for-single-processor-runs-optional" title="Link to this heading">#</a></h3>
<p>For single-processor computing, edit the CCTM build script (bldit_cctm.csh) to indicate a single-processor run by commenting out set ParOpt as shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#set ParOpt #&gt; Option for Single Processor Runs</span>
</pre></div>
</div>
</section>
<section id="configure-cmaq-benchmark-science-modules">
<h3>Configure CMAQ benchmark Science Modules:<a class="headerlink" href="#configure-cmaq-benchmark-science-modules" title="Link to this heading">#</a></h3>
<p>The build directory parameters for the benchmark test case include the following:</p>
<ul class="simple">
<li><p>Multiprocessor simulation</p></li>
<li><p>3-D Advection Scheme: wrf_cons</p></li>
<li><p>Horizontal diffusion: Multiscale</p></li>
<li><p>Vertical diffusion: ACM2_Stage</p></li>
<li><p>Deposition: STAGE</p></li>
<li><p>Chemistry solver: EBI</p></li>
<li><p>Aerosol module: cracmm</p></li>
<li><p>Cloud module: acm_craccm</p></li>
<li><p>Mechanism: cracmm2</p></li>
<li><p>Inline biogenic emissions</p></li>
<li><p>Inline plume rise</p></li>
</ul>
<p>To configure these parameters, the CCTM Science Modules within the bldit_cctm.csh need to be set. The comments within the script itself should help guide the user on the options for each variable and how to set them. Further information on variable names can be found in
<a class="reference internal" href="../Appendix/CMAQ_UG_appendixA_model_options.html"><span class="std std-doc">Appendix A</span></a>.</p>
<p>Modify the dry deposition scheme to use STAGE instead of M3DRY</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#&gt; Set Dry Deposition Scheme to Stage</span>

 <span class="nb">set</span> <span class="n">DepMod</span>    <span class="o">=</span> <span class="n">stage</span>
</pre></div>
</div>
<p>Modify the Mechanism to use craccm2 instead of cb6r5</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">setenv</span> <span class="n">Mechanism</span> <span class="n">cracmm2</span>              <span class="c1">#&gt; chemical mechanism (see $CMAQ_MODEL/CCTM/src/MECHS)</span>
</pre></div>
</div>
<p>Following the requisite changes to the CCTM build script, use the following command to create the CCTM executable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $CMAQ_HOME/CCTM/scripts
./bldit_cctm_cracmm2_stage.csh [compiler] [version] |&amp; tee bldit_cctm_cracmm2_stage.log
</pre></div>
</div>
<p>Verify that the BLD directory contains a namelist called</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CMAQ_Control_STAGE</span><span class="o">.</span><span class="n">nml</span>
</pre></div>
</div>
</section>
</section>
<section id="configure-the-cctm-script">
<h2>Configure the CCTM script<a class="headerlink" href="#configure-the-cctm-script" title="Link to this heading">#</a></h2>
<p>For an MPI configuration with 16 processors,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $CMAQ_HOME/CCTM/scripts
</pre></div>
</div>
<p>Edit the CCTM run script (run_cctm_Bench_2018_12NE3_CRACMM2.csh) for the MPI configuration and compiler that you will use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>setenv compiler gcc
setenv compilerVrsn 9.5
setenv INPDIR  ${CMAQ_DATA}/2018_12NE3
@ NPCOL 8 ; @ NPROW = 4
</pre></div>
</div>
<p>Most clustered multiprocessor systems require a command to start the MPI run-time environment. The default CCTM run script uses the <em>mpirun</em> command. Consult your system administrator to find out how to invoke MPI when running multiprocessor applications.</p>
<p>For single-processor computing, set PROC to serial:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">PROC</span>     <span class="o">=</span> <span class="n">serial</span>
</pre></div>
</div>
<p>CCTM Science Configuration Options set to <strong>Y</strong> in the RunScript for the benchmark case include the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CTM_OCEAN_CHEM</span></code> - use ocean halgoen chemistry and sea spray aerosol emissions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">KZMIN</span></code> - minimum eddy diffusivity in each grid cell determined by land use fraction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PX_VERSION</span></code> - WRF PX land surface model</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTM_ABFLUX</span></code> - bidirectional ammonia flux for online deposition velocities</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTM_BIDI_FERT_NH3</span></code> - subtract fertilizer NH3 from emissions because it will be handled by the BiDi calculation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTM_SFC_HONO</span></code> - surface HONO interaction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTM_GRAV_SETL</span></code> - vdiff aerosol gravitational sedmentation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTM_BIOGEMIS</span></code> - online biogenic emissions</p></li>
</ul>
<p>To configure these parameters, the Science Options within the $CMAQ_HOME/CCTM/scripts/run_cctm_Bench_2018_12NE3_CRACMM2.csh need to be set. The comments within the script itself should help guide the user on the options for each variable and how to set them. Further information on variable names can be found in
<a class="reference internal" href="../Appendix/CMAQ_UG_appendixA_model_options.html"><span class="std std-doc">Appendix A</span></a>.</p>
<p>After configuring the MPI settings for your Linux system, check the rest of the script to ensure the correct path, date and names are used for the input data files. Per the note above, different Linux systems have different requirements for submitting MPI jobs.  The command below is an example of how to submit the CCTM run script and may differ depending on the MPI requirements of your Linux system.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cctm_Bench_2018_12NE3_CRACMM2</span><span class="o">.</span><span class="n">csh</span> <span class="o">|&amp;</span> <span class="n">tee</span> <span class="n">run_cctm_Bench_2018_12NE3_CRACMM2</span><span class="o">.</span><span class="n">log</span> 
</pre></div>
</div>
</section>
<section id="confirm-that-the-benchmark-simulation-completed">
<h2>Confirm that the Benchmark Simulation Completed<a class="headerlink" href="#confirm-that-the-benchmark-simulation-completed" title="Link to this heading">#</a></h2>
<p>To confirm that the benchmark case ran to completion view the run log file. For MPI runs, check each of the CTM_LOG_[ProcessorID]*.log files. A successful run will contain the following line at the bottom of the log(s):</p>
<p><code class="docutils literal notranslate"><span class="pre">&gt;&gt;----&gt;</span>&#160; <span class="pre">Program</span> <span class="pre">completed</span> <span class="pre">successfully</span>&#160; <span class="pre">&lt;----&lt;&lt;</span></code></p>
<p>Note: If you are running on multiple processors the log file for each processor is also moved from the $CMAQ_HOME/CCTM/scripts directory to the benchmark output directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$CMAQ_DATA/output_CCTM_v55_gcc_Bench_2018_12NE3_cracmm2_stage
</pre></div>
</div>
<p>and these log files have the name convention:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CTM_LOG_</span><span class="p">[</span><span class="n">ProcessorID</span><span class="p">]</span><span class="o">.</span><span class="n">v55_</span><span class="p">[</span><span class="n">compiler</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">APPL</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">YYYYMMDD</span><span class="p">]</span>
<span class="n">CTM_LOG_</span><span class="p">[</span><span class="n">ProcessorID</span><span class="p">]</span><span class="o">.</span><span class="n">v55_gcc_Bench_2018_12NE3_2day_20180702</span>
</pre></div>
</div>
<p>The benchmark output results will have been placed in the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$CMAQ_DATA/output_CCTM_v55_gcc_Bench_2018_12NE3_cracmm2_stage
</pre></div>
</div>
<p>and can include upto 23 netCDF-type files: ACONC, AOD_DIAG, AELMO, APMVIS, B3GTS_S, BSOILOUT, BUDGET, CGRID, CONC, DEPV, DRYDEP, DUSTEMIS, LTNGCOL, LTNGHRLY, MEDIA_CONC, PHOTDIAG1, PHOTDIAG2, ELMO, PMVIS, SOILOUT, SSEMIS, VDIFF, VSED, WETDEP1, and WETDEP2.</p>
<p>Common errors in a CCTM simulation include the following:</p>
<ul class="simple">
<li><p>Incorrect paths to input files. Look in the CCTM screen output (capture in your log file) for an Error message about an input file not being found.</p></li>
<li><p>Incorrect MPI implementation. A series of MPI errors at the end of the log file often indicate that the MPI job was not submitted correctly.</p></li>
</ul>
<p>Check the last few lines of the CCTM output log for messages to help diagnose why the simulation did not complete.</p>
</section>
<section id="check-the-cmaq-benchmark-results">
<h2>Check the CMAQ Benchmark Results<a class="headerlink" href="#check-the-cmaq-benchmark-results" title="Link to this heading">#</a></h2>
<p>To determine if CMAQ is correctly installed on your Linux system compare the results from your benchmark simulation to the reference output data downloaded from the CMAS Center. This data was generated on a Linux system with the following specifications:</p>
<ul class="simple">
<li><p>Linux Kernel 3.10.0-514.el7.x86_64</p></li>
<li><p>Red Hat Enterprise Linux Server 7.3 (Maipo) (use command: cat /etc/os-release)</p></li>
<li><p>GNU GCC compiler version 9.1.0, 16 processors with OpenMPIv4.0.1 and I/O APIv3.2 tagged version 20200828</p></li>
<li><p>Debug mode turned off (<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">Debug_CCTM</span></code> commented out in $CMAQ_HOME/CCTM/scripts/bldit_cctm.csh)</p></li>
<li><p>CMAQv5.5</p></li>
</ul>
<p>The CMAQv5.5 reference output data includes a set of CCTM_ACONC_*.nc files with layer 1 average model species concentrations for each model hour for 226 variables and a set of CCTM_WETDEP1_*.nc files with cumulative hourly wet deposition fluxes for an additional 136 variables.</p>
<p>Use your netCDF evaluation tool of choice to evaluate your benchmark results. For example, <a class="reference external" href="https://www.verdi-tool.org/">VERDI</a> is a visualization tool to view CCTM results as tile plots. Statistical comparison of the results can be made with the I/O API Tools or R.</p>
<p>Note, even with a successful installation and run of the benchmark case, some differences between your simulation and the reference data can occur due to differences in domain decomposition for multi-processor simulations as well as differences in compiler.  These differences tend to manifest in upper layers of the model and are mostly found in predicting aerosol water (AH2O) and aerosol acidity (AH3OP), while differences are smaller for other key species like ASO4, ANO3, ACL, ALOO1, etc. These species have short atmospheric lifetimes with large changes in time and space derivatives or have model physics sensitive to small changes in concentration. Predicting these species is more sensitive to small changes in machine precision and accuracy.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-checks">System Checks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-cmaq-and-required-libraries">Install CMAQ and Required Libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-out-a-new-branch-in-the-cmaq-repository">Check Out a new Branch in the CMAQ Repository</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-the-cmaq-build-environment">Configure the CMAQ build environment</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-and-run-in-a-user-specified-directory-outside-of-the-repository">Build and run in a user-specified directory outside of the repository</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#link-the-cmaq-libraries">Link the CMAQ Libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-the-cmaq-reference-input-and-output-benchmark-data">Install the CMAQ reference input and output benchmark data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compiling-cmaq">Compiling CMAQ</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-for-multi-processor-runs-default">Configuration for multi-processor runs (default):</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-for-single-processor-runs-optional">Configuration for single-processor runs (optional):</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-cmaq-benchmark-science-modules">Configure CMAQ benchmark Science Modules:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-the-cctm-script">Configure the CCTM script</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confirm-that-the-benchmark-simulation-completed">Confirm that the Benchmark Simulation Completed</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-cmaq-benchmark-results">Check the CMAQ Benchmark Results</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/Users_Guide/Tutorials/CMAQ_UG_tutorial_benchmark_cracmm2_stage.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, CMAQ Developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>